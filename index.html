<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de CorrespondÃªncias</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e9ecef;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4285f4, #34a853);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .system-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a73e8;
        }

        .condominio-name {
            color: #666;
            font-size: 0.9rem;
        }

        .navigation {
            display: flex;
            gap: 2rem;
            background: white;
            padding: 0 2rem;
            border-bottom: 1px solid #e9ecef;
        }

        .nav-item {
            padding: 1rem 0;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .nav-item:hover {
            color: #1a73e8;
        }

        .nav-item.active {
            color: #1a73e8;
            border-bottom-color: #1a73e8;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-info h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .icon-users { background: #e3f2fd; color: #1976d2; }
        .icon-mail { background: #e8f5e8; color: #2e7d32; }
        .icon-clock { background: #fff3e0; color: #f57c00; }
        .icon-alert { background: #ffebee; color: #d32f2f; }
        .icon-check { background: #f3e5f5; color: #7b1fa2; }
        .icon-delay { background: #fce4ec; color: #c2185b; }

        .actions-section {
            margin-bottom: 2rem;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: #1a73e8;
            color: white;
        }

        .btn-primary:hover {
            background: #1557b0;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ff6d00;
            color: white;
        }

        .btn-warning:hover {
            background: #e65100;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #ddd;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .alert-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #856404;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .content-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .card-content {
            padding: 1.5rem;
        }

        .correspondence-item {
            padding: 1rem;
            border-bottom: 1px solid #f1f3f4;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .correspondence-item:last-child {
            border-bottom: none;
        }

        .correspondence-info {
            flex: 1;
        }

        .correspondence-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .correspondence-details {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .correspondence-meta {
            color: #999;
            font-size: 0.8rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 1rem;
        }

        .status-pendente {
            background: #fff3cd;
            color: #856404;
        }

        .status-entregue {
            background: #d4edda;
            color: #155724;
        }

        .notify-btn {
            background: #ff6d00;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: 1rem;
        }

        .notify-btn:hover {
            background: #e65100;
        }

        .form-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #333;
        }

        input, select, textarea {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #1a73e8;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            padding-top: 1rem;
            border-top: 1px solid #e9ecef;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filters {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            background: #f8f9fa;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #666;
            border-bottom: 1px solid #e9ecef;
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid #f1f3f4;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .action-link {
            color: #25d366;
            text-decoration: none;
            font-size: 1.2rem;
            margin: 0 0.5rem;
        }

        .action-link:hover {
            transform: scale(1.2);
        }

        .hidden {
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: #dc3545;
        }

        .danger-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .danger-btn:hover {
            background: #c82333;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                padding: 0 1rem;
                overflow-x: auto;
            }
            
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .filters {
                grid-template-columns: 1fr;
            }
            
            .table-container {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo-section">
            <div class="logo">
                <i class="fas fa-mail-bulk"></i>
            </div>
            <div>
                <div class="system-title">
                    <i class="fas fa-envelope"></i>
                    Sistema de CorrespondÃªncias
                </div>
            </div>
        </div>
        <div class="condominio-name">
            CondomÃ­nio Residencial Algodoeiro
        </div>
    </header>

    <nav class="navigation">
        <a href="#" class="nav-item active" onclick="showSection('dashboard')">
            <i class="fas fa-chart-bar"></i>
            Dashboard
        </a>
        <a href="#" class="nav-item" onclick="showSection('correspondencias')">
            <i class="fas fa-envelope"></i>
            CorrespondÃªncias
        </a>
        <a href="#" class="nav-item" onclick="showSection('moradores')">
            <i class="fas fa-users"></i>
            Moradores
        </a>
    </nav>

    <div class="container">
        <!-- Dashboard Section -->
        <div id="dashboard-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon icon-users">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalMoradores">0</h3>
                        <p>Total<br>Moradores</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-mail">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalCorrespondencias">0</h3>
                        <p>Total<br>CorrespondÃªncias</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-clock">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="recebidasHoje">0</h3>
                        <p>Recebidas<br>Hoje</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-alert">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pendentes">0</h3>
                        <p>Pendentes</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-check">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="entreguesToday">0</h3>
                        <p>Entregues<br>Hoje</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-delay">
                        <i class="fas fa-hourglass-half"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="atrasadas">0</h3>
                        <p>Atrasadas<br>+3 dias</p>
                    </div>
                </div>
            </div>

            <div class="actions-section">
                <h2 class="section-title">
                    <i class="fas fa-bolt"></i>
                    AÃ§Ãµes RÃ¡pidas
                </h2>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="exportarDados()">
                        <i class="fas fa-download"></i>
                        Exportar Dados
                    </button>
                    <button class="btn btn-warning" onclick="notificarAtrasadas()">
                        <i class="fas fa-bell"></i>
                        Notificar Atrasadas
                    </button>
                </div>
            </div>

            <div class="alert-box" id="alertaAtrasadas" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="mensagemAlerta"></span>
            </div>

            <div class="content-grid">
                <div class="content-card">
                    <div class="card-header">
                        <i class="fas fa-envelope"></i>
                        CorrespondÃªncias Recentes
                    </div>
                    <div class="card-content" id="correspondenciasRecentes">
                        <p style="color: #666; text-align: center; padding: 2rem;">
                            Nenhuma correspondÃªncia registrada ainda
                        </p>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <i class="fas fa-building"></i>
                        Resumo por Bloco
                    </div>
                    <div class="card-content" id="resumoBlocos">
                        <p style="color: #666; text-align: center; padding: 2rem;">
                            Nenhum morador cadastrado ainda
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- CorrespondÃªncias Section -->
        <div id="correspondencias-section" class="hidden">
            <div class="form-container">
                <h2 class="section-title">
                    <i class="fas fa-envelope"></i>
                    Registrar Nova CorrespondÃªncia
                </h2>
                <p style="color: #666; margin-bottom: 2rem;">Cadastre uma nova correspondÃªncia recebida na portaria</p>

                <form id="formCorrespondencia">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="dataRecebimento">Data de Recebimento *</label>
                            <input type="date" id="dataRecebimento" required>
                        </div>
                        <div class="form-group">
                            <label for="horaRecebimento">Hora de Recebimento</label>
                            <input type="time" id="horaRecebimento">
                        </div>
                        <div class="form-group">
                            <label for="bloco">Bloco *</label>
                            <select id="bloco" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="apartamento">Apartamento *</label>
                            <select id="apartamento" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label for="descricao">DescriÃ§Ã£o do Produto/CorrespondÃªncia *</label>
                            <textarea id="descricao" placeholder="Ex: Encomenda dos Correios - Caixa mÃ©dia, CorrespondÃªncia bancÃ¡ria - Envelope..." maxlength="500" required></textarea>
                            <small style="color: #666; margin-top: 0.5rem; display: block;">
                                <span id="contadorCaracteres">0/500 caracteres</span>
                            </small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="limparFormulario('formCorrespondencia')">
                            <i class="fas fa-broom"></i>
                            Limpar FormulÃ¡rio
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Registrar e Notificar
                        </button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fas fa-list"></i>
                        CorrespondÃªncias Registradas (<span id="contadorCorrespondencias">0</span>)
                    </div>
                    <div>
                        <button class="btn btn-success" onclick="exportarCorrespondencias()">
                            <i class="fas fa-file-excel"></i>
                            Exportar Excel
                        </button>
                    </div>
                </div>

                <div class="filters">
                    <div class="form-group">
                        <label>Buscar Morador</label>
                        <input type="text" id="filtroMorador" placeholder="Nome do morador..." onkeyup="filtrarCorrespondencias()">
                    </div>
                    <div class="form-group">
                        <label>Bloco</label>
                        <select id="filtroBloco" onchange="filtrarCorrespondencias()">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="filtroStatus" onchange="filtrarCorrespondencias()">
                            <option value="">Todos</option>
                            <option value="Pendente">Pendente</option>
                            <option value="Entregue">Entregue</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-secondary" onclick="limparFiltros()" style="margin-top: 1.5rem;">
                            <i class="fas fa-eraser"></i>
                            Limpar Filtros
                        </button>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>DATA/HORA</th>
                                <th>MORADOR</th>
                                <th>UNIDADE</th>
                                <th>DESCRIÃÃO</th>
                                <th>STATUS</th>
                                <th>AÃÃES</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaCorrespondencias">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 2rem; color: #666;">
                                    Nenhuma correspondÃªncia registrada ainda
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Moradores Section -->
        <div id="moradores-section" class="hidden">
            <div class="form-container">
                <h2 class="section-title">
                    <i class="fas fa-user-plus"></i>
                    Cadastrar Novo Morador
                </h2>

                <form id="formMorador">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="nomeCompleto">Nome Completo *</label>
                            <input type="text" id="nomeCompleto" placeholder="Digite o nome completo" required>
                        </div>
                        <div class="form-group">
                            <label for="telefone">Telefone (WhatsApp) *</label>
                            <input type="tel" id="telefone" placeholder="(11) 99999-9999" required>
                        </div>
                        <div class="form-group">
                            <label for="blocoMorador">Bloco *</label>
                            <input type="text" id="blocoMorador" placeholder="Ex: A, B, C, 1, 2..." required>
                        </div>
                        <div class="form-group">
                            <label for="apartamentoMorador">Apartamento *</label>
                            <input type="text" id="apartamentoMorador" placeholder="Ex: 101, 102, 201..." required>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="limparFormulario('formMorador')">
                            <i class="fas fa-broom"></i>
                            Limpar FormulÃ¡rio
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i>
                            Cadastrar Morador
                        </button>
                    </div>
                </form>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fas fa-users"></i>
                        Moradores Cadastrados (<span id="contadorMoradores">0</span>)
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <input type="text" id="buscaMorador" placeholder="Buscar por nome..." style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 6px;" onkeyup="filtrarMoradores()">
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>NOME</th>
                                <th>UNIDADE</th>
                                <th>TELEFONE</th>
                                <th>AÃÃES</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaMoradores">
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 2rem; color: #666;">
                                    Nenhum morador cadastrado ainda
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de EdiÃ§Ã£o de Morador -->
    <div id="modalEditarMorador" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Morador</h3>
                <button class="close" onclick="fecharModal('modalEditarMorador')">&times;</button>
            </div>
            <form id="formEditarMorador">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nome Completo</label>
                        <input type="text" id="editNome" required>
                    </div>
                    <div class="form-group">
                        <label>Telefone</label>
                        <input type="tel" id="editTelefone" required>
                    </div>
                    <div class="form-group">
                        <label>Bloco</label>
                        <input type="text" id="editBloco" required>
                    </div>
                    <div class="form-group">
                        <label>Apartamento</label>
                        <input type="text" id="editApartamento" required>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modalEditarMorador')">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Salvar AlteraÃ§Ãµes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Dados armazenados em memÃ³ria
        let moradores = [];
        let correspondencias = [];
        let moradoresFiltrados = [];
        let correspondenciasFiltradas = [];
        let editandoMoradorId = null;

        // InicializaÃ§Ã£o
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data atual
            document.getElementById('dataRecebimento').value = new Date().toISOString().split('T')[0];
            document.getElementById('horaRecebimento').value = new Date().toTimeString().slice(0, 5);

            // Contador de caracteres
            const descricaoTextarea = document.getElementById('descricao');
            const contador = document.getElementById('contadorCaracteres');
            
            descricaoTextarea.addEventListener('input', function() {
                contador.textContent = `${this.value.length}/500 caracteres`;
            });

            // Event listeners para formulÃ¡rios
            document.getElementById('formMorador').addEventListener('submit', cadastrarMorador);
            document.getElementById('formCorrespondencia').addEventListener('submit', registrarCorrespondencia);
            document.getElementById('formEditarMorador').addEventListener('submit', salvarEdicaoMorador);

            // Event listener para mudanÃ§a de bloco
            document.getElementById('bloco').addEventListener('change', atualizarApartamentos);

            // Aplicar mÃ¡scara no telefone
            document.getElementById('telefone').addEventListener('input', aplicarMascaraTelefone);
            document.getElementById('editTelefone').addEventListener('input', aplicarMascaraTelefone);

            atualizarDashboard();
            atualizarSelectsBlocos();
        });

        // NavegaÃ§Ã£o
        function showSection(sectionName) {
            // Ocultar todas as seÃ§Ãµes
            document.getElementById('dashboard-section').classList.add('hidden');
            document.getElementById('correspondencias-section').classList.add('hidden');
            document.getElementById('moradores-section').classList.add('hidden');

            // Remover classe active de todos os nav-items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Mostrar seÃ§Ã£o selecionada
            document.getElementById(sectionName + '-section').classList.remove('hidden');

            // Adicionar classe active ao nav-item selecionado
            event.target.closest('.nav-item').classList.add('active');

            // Atualizar dados conforme necessÃ¡rio
            if (sectionName === 'dashboard') {
                atualizarDashboard();
            } else if (sectionName === 'correspondencias') {
                atualizarTabelaCorrespondencias();
                atualizarSelectsBlocos();
            } else if (sectionName === 'moradores') {
                atualizarTabelaMoradores();
            }
        }

        // MÃ¡scaras
        function aplicarMascaraTelefone(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                if (value.length < 14) {
                    value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                }
            }
            e.target.value = value;
        }

        // Cadastro de Moradores
        function cadastrarMorador(e) {
            e.preventDefault();
            
            const nome = document.getElementById('nomeCompleto').value.trim();
            const telefone = document.getElementById('telefone').value.trim();
            const bloco = document.getElementById('blocoMorador').value.trim().toUpperCase();
            const apartamento = document.getElementById('apartamentoMorador').value.trim();

            // ValidaÃ§Ãµes
            if (!nome || !telefone || !bloco || !apartamento) {
                mostrarToast('Todos os campos sÃ£o obrigatÃ³rios!', 'error');
                return;
            }

            // Verificar se a unidade jÃ¡ existe
            const unidadeExiste = moradores.some(m => 
                m.bloco === bloco && m.apartamento === apartamento
            );

            if (unidadeExiste) {
                mostrarToast('JÃ¡ existe um morador cadastrado nesta unidade!', 'error');
                return;
            }

            const novoMorador = {
                id: Date.now(),
                nome,
                telefone,
                bloco,
                apartamento,
                dataCadastro: new Date().toISOString()
            };

            moradores.push(novoMorador);
            document.getElementById('formMorador').reset();
            
            atualizarTabelaMoradores();
            atualizarDashboard();
            atualizarSelectsBlocos();
            
            mostrarToast('Morador cadastrado com sucesso!');
        }

        function editarMorador(id) {
            const morador = moradores.find(m => m.id === id);
            if (!morador) return;

            editandoMoradorId = id;
            document.getElementById('editNome').value = morador.nome;
            document.getElementById('editTelefone').value = morador.telefone;
            document.getElementById('editBloco').value = morador.bloco;
            document.getElementById('editApartamento').value = morador.apartamento;

            document.getElementById('modalEditarMorador').style.display = 'block';
        }

        function salvarEdicaoMorador(e) {
            e.preventDefault();
            
            const nome = document.getElementById('editNome').value.trim();
            const telefone = document.getElementById('editTelefone').value.trim();
            const bloco = document.getElementById('editBloco').value.trim().toUpperCase();
            const apartamento = document.getElementById('editApartamento').value.trim();

            if (!nome || !telefone || !bloco || !apartamento) {
                mostrarToast('Todos os campos sÃ£o obrigatÃ³rios!', 'error');
                return;
            }

            const morador = moradores.find(m => m.id === editandoMoradorId);
            if (morador) {
                morador.nome = nome;
                morador.telefone = telefone;
                morador.bloco = bloco;
                morador.apartamento = apartamento;
                
                atualizarTabelaMoradores();
                atualizarDashboard();
                atualizarSelectsBlocos();
                fecharModal('modalEditarMorador');
                mostrarToast('Morador atualizado com sucesso!');
            }
        }

        function excluirMorador(id) {
            if (confirm('Tem certeza que deseja excluir este morador?')) {
                moradores = moradores.filter(m => m.id !== id);
                atualizarTabelaMoradores();
                atualizarDashboard();
                atualizarSelectsBlocos();
                mostrarToast('Morador excluÃ­do com sucesso!');
            }
        }

        function atualizarTabelaMoradores() {
            const tbody = document.getElementById('tabelaMoradores');
            const contador = document.getElementById('contadorMoradores');
            
            contador.textContent = moradores.length;
            
            if (moradores.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 2rem; color: #666;">
                            Nenhum morador cadastrado ainda
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = moradores.map(morador => `
                <tr>
                    <td>
                        <div class="user-info">
                            <div class="user-avatar">
                                ${morador.nome.charAt(0).toUpperCase()}
                            </div>
                            <strong>${morador.nome}</strong>
                        </div>
                    </td>
                    <td>Bloco ${morador.bloco} - Apt ${morador.apartamento}</td>
                    <td>${morador.telefone}</td>
                    <td>
                        <a href="https://wa.me/55${morador.telefone.replace(/\D/g, '')}" target="_blank" class="action-link" title="Enviar WhatsApp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                        <button onclick="editarMorador(${morador.id})" class="btn-secondary" style="padding: 0.25rem 0.5rem; margin: 0 0.25rem;" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="excluirMorador(${morador.id})" class="danger-btn" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // CorrespondÃªncias
        function registrarCorrespondencia(e) {
            e.preventDefault();
            
            const data = document.getElementById('dataRecebimento').value;
            const hora = document.getElementById('horaRecebimento').value || '12:00';
            const bloco = document.getElementById('bloco').value;
            const apartamento = document.getElementById('apartamento').value;
            const descricao = document.getElementById('descricao').value.trim();

            if (!data || !bloco || !apartamento || !descricao) {
                mostrarToast('Todos os campos obrigatÃ³rios devem ser preenchidos!', 'error');
                return;
            }

            const morador = moradores.find(m => 
                m.bloco === bloco && m.apartamento === apartamento
            );

            if (!morador) {
                mostrarToast('Morador nÃ£o encontrado para esta unidade!', 'error');
                return;
            }

            const novaCorrespondencia = {
                id: Date.now(),
                data,
                hora,
                moradorId: morador.id,
                morador: morador.nome,
                bloco,
                apartamento,
                descricao,
                status: 'Pendente',
                dataRegistro: new Date().toISOString()
            };

            correspondencias.unshift(novaCorrespondencia);
            document.getElementById('formCorrespondencia').reset();
            document.getElementById('dataRecebimento').value = new Date().toISOString().split('T')[0];
            document.getElementById('horaRecebimento').value = new Date().toTimeString().slice(0, 5);
            document.getElementById('contadorCaracteres').textContent = '0/500 caracteres';
            
            atualizarTabelaCorrespondencias();
            atualizarDashboard();
            
            // Enviar notificaÃ§Ã£o WhatsApp
            const mensagem = `OlÃ¡ ${morador.nome}! VocÃª tem uma correspondÃªncia na portaria: ${descricao}. Data: ${formatarData(data)} ${hora}`;
            const urlWhatsApp = `https://wa.me/55${morador.telefone.replace(/\D/g, '')}?text=${encodeURIComponent(mensagem)}`;
            window.open(urlWhatsApp, '_blank');
            
            mostrarToast('CorrespondÃªncia registrada e notificaÃ§Ã£o enviada!');
        }

        function marcarComoEntregue(id) {
            const correspondencia = correspondencias.find(c => c.id === id);
            if (correspondencia) {
                correspondencia.status = 'Entregue';
                correspondencia.dataEntrega = new Date().toISOString();
                atualizarTabelaCorrespondencias();
                atualizarDashboard();
                mostrarToast('CorrespondÃªncia marcada como entregue!');
            }
        }

        function reenviarNotificacao(id) {
            const correspondencia = correspondencias.find(c => c.id === id);
            if (!correspondencia) return;

            const morador = moradores.find(m => m.id === correspondencia.moradorId);
            if (!morador) return;

            const mensagem = `LEMBRETE: VocÃª tem uma correspondÃªncia pendente na portaria: ${correspondencia.descricao}. Data: ${formatarData(correspondencia.data)} ${correspondencia.hora}`;
            const urlWhatsApp = `https://wa.me/55${morador.telefone.replace(/\D/g, '')}?text=${encodeURIComponent(mensagem)}`;
            window.open(urlWhatsApp, '_blank');
            mostrarToast('NotificaÃ§Ã£o reenviada!');
        }

        function excluirCorrespondencia(id) {
            if (confirm('Tem certeza que deseja excluir esta correspondÃªncia?')) {
                correspondencias = correspondencias.filter(c => c.id !== id);
                atualizarTabelaCorrespondencias();
                atualizarDashboard();
                mostrarToast('CorrespondÃªncia excluÃ­da com sucesso!');
            }
        }

        function atualizarTabelaCorrespondencias() {
            const tbody = document.getElementById('tabelaCorrespondencias');
            const contador = document.getElementById('contadorCorrespondencias');
            
            contador.textContent = correspondencias.length;
            
            if (correspondencias.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem; color: #666;">
                            Nenhuma correspondÃªncia registrada ainda
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = correspondencias.map(corr => {
                const morador = moradores.find(m => m.id === corr.moradorId);
                const diasAtrasada = calcularDiasAtrasada(corr.data);
                const isAtrasada = corr.status === 'Pendente' && diasAtrasada > 3;
                
                return `
                    <tr ${isAtrasada ? 'style="background-color: #fff5f5;"' : ''}>
                        <td>
                            ${formatarData(corr.data)}<br>
                            <small style="color: #666;">${corr.hora}</small>
                        </td>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">
                                    ${corr.morador.charAt(0).toUpperCase()}
                                </div>
                                <strong>${corr.morador}</strong>
                            </div>
                        </td>
                        <td>Bloco ${corr.bloco}<br>Apt ${corr.apartamento}</td>
                        <td style="max-width: 200px; word-wrap: break-word;">${corr.descricao}</td>
                        <td>
                            <span class="status-badge ${corr.status === 'Entregue' ? 'status-entregue' : 'status-pendente'}">
                                ${corr.status}
                            </span>
                            ${isAtrasada ? '<br><small style="color: #d32f2f;">Atrasada</small>' : ''}
                        </td>
                        <td>
                            ${corr.status === 'Pendente' ? `
                                <button onclick="marcarComoEntregue(${corr.id})" class="btn btn-success" style="padding: 0.25rem 0.5rem; margin: 0.1rem;" title="Marcar como entregue">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button onclick="reenviarNotificacao(${corr.id})" class="notify-btn" style="padding: 0.25rem 0.5rem; margin: 0.1rem;" title="Reenviar notificaÃ§Ã£o">
                                    <i class="fab fa-whatsapp"></i>
                                </button>
                            ` : ''}
                            <button onclick="excluirCorrespondencia(${corr.id})" class="danger-btn" style="margin: 0.1rem;" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // AtualizaÃ§Ã£o de selects
        function atualizarSelectsBlocos() {
            const blocos = [...new Set(moradores.map(m => m.bloco))].sort();
            
            const selectBloco = document.getElementById('bloco');
            const selectFiltroBloco = document.getElementById('filtroBloco');
            
            // Limpar e recriar opÃ§Ãµes
            selectBloco.innerHTML = '<option value="">Selecione...</option>';
            selectFiltroBloco.innerHTML = '<option value="">Todos</option>';
            
            blocos.forEach(bloco => {
                selectBloco.innerHTML += `<option value="${bloco}">Bloco ${bloco}</option>`;
                selectFiltroBloco.innerHTML += `<option value="${bloco}">Bloco ${bloco}</option>`;
            });
        }

        function atualizarApartamentos() {
            const blocoSelecionado = document.getElementById('bloco').value;
            const selectApartamento = document.getElementById('apartamento');
            
            selectApartamento.innerHTML = '<option value="">Selecione...</option>';
            
            if (blocoSelecionado) {
                const apartamentos = moradores
                    .filter(m => m.bloco === blocoSelecionado)
                    .map(m => m.apartamento)
                    .sort();
                
                apartamentos.forEach(apt => {
                    selectApartamento.innerHTML += `<option value="${apt}">Apartamento ${apt}</option>`;
                });
            }
        }

        // Dashboard
        function atualizarDashboard() {
            const hoje = new Date().toISOString().split('T')[0];
            
            // EstatÃ­sticas bÃ¡sicas
            document.getElementById('totalMoradores').textContent = moradores.length;
            document.getElementById('totalCorrespondencias').textContent = correspondencias.length;
            
            const recebidasHoje = correspondencias.filter(c => c.data === hoje).length;
            document.getElementById('recebidasHoje').textContent = recebidasHoje;
            
            const pendentes = correspondencias.filter(c => c.status === 'Pendente').length;
            document.getElementById('pendentes').textContent = pendentes;
            
            const entreguesToday = correspondencias.filter(c => 
                c.status === 'Entregue' && c.dataEntrega && c.dataEntrega.split('T')[0] === hoje
            ).length;
            document.getElementById('entreguesToday').textContent = entreguesToday;
            
            const atrasadas = correspondencias.filter(c => 
                c.status === 'Pendente' && calcularDiasAtrasada(c.data) > 3
            ).length;
            document.getElementById('atrasadas').textContent = atrasadas;
            
            // Alerta de atrasadas
            const alertaAtrasadas = document.getElementById('alertaAtrasadas');
            const mensagemAlerta = document.getElementById('mensagemAlerta');
            
            if (atrasadas > 0) {
                alertaAtrasadas.style.display = 'flex';
                mensagemAlerta.textContent = `AtenÃ§Ã£o! Existem ${atrasadas} correspondÃªncia(s) com mais de 3 dias sem retirada.`;
            } else {
                alertaAtrasadas.style.display = 'none';
            }
            
            atualizarCorrespondenciasRecentes();
            atualizarResumoBlocos();
        }

        function atualizarCorrespondenciasRecentes() {
            const container = document.getElementById('correspondenciasRecentes');
            const recentes = correspondencias.slice(0, 5);
            
            if (recentes.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 2rem;">Nenhuma correspondÃªncia registrada ainda</p>';
                return;
            }
            
            container.innerHTML = recentes.map(corr => `
                <div class="correspondence-item">
                    <div class="correspondence-info">
                        <div class="correspondence-name">${corr.morador}</div>
                        <div class="correspondence-details">Bloco ${corr.bloco} - Apt ${corr.apartamento}</div>
                        <div class="correspondence-meta">${formatarData(corr.data)} ${corr.hora}</div>
                    </div>
                    <span class="status-badge ${corr.status === 'Entregue' ? 'status-entregue' : 'status-pendente'}">
                        ${corr.status}
                    </span>
                </div>
            `).join('');
        }

        function atualizarResumoBlocos() {
            const container = document.getElementById('resumoBlocos');
            const blocos = [...new Set(moradores.map(m => m.bloco))].sort();
            
            if (blocos.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 2rem;">Nenhum morador cadastrado ainda</p>';
                return;
            }
            
            container.innerHTML = blocos.map(bloco => {
                const moradoresBloco = moradores.filter(m => m.bloco === bloco).length;
                const correspondenciasBloco = correspondencias.filter(c => c.bloco === bloco).length;
                const pendentesBloco = correspondencias.filter(c => c.bloco === bloco && c.status === 'Pendente').length;
                
                return `
                    <div class="correspondence-item">
                        <div class="correspondence-info">
                            <div class="correspondence-name">Bloco ${bloco}</div>
                            <div class="correspondence-details">${moradoresBloco} moradores</div>
                            <div class="correspondence-meta">${correspondenciasBloco} correspondÃªncias total</div>
                        </div>
                        ${pendentesBloco > 0 ? `<span class="status-badge status-pendente">${pendentesBloco} pendentes</span>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Filtros
        function filtrarMoradores() {
            const busca = document.getElementById('buscaMorador').value.toLowerCase();
            const tbody = document.getElementById('tabelaMoradores');
            
            const moradoresFiltrados = moradores.filter(morador => 
                morador.nome.toLowerCase().includes(busca)
            );
            
            if (moradoresFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 2rem; color: #666;">
                            Nenhum morador encontrado
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = moradoresFiltrados.map(morador => `
                <tr>
                    <td>
                        <div class="user-info">
                            <div class="user-avatar">
                                ${morador.nome.charAt(0).toUpperCase()}
                            </div>
                            <strong>${morador.nome}</strong>
                        </div>
                    </td>
                    <td>Bloco ${morador.bloco} - Apt ${morador.apartamento}</td>
                    <td>${morador.telefone}</td>
                    <td>
                        <a href="https://wa.me/55${morador.telefone.replace(/\D/g, '')}" target="_blank" class="action-link" title="Enviar WhatsApp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                        <button onclick="editarMorador(${morador.id})" class="btn-secondary" style="padding: 0.25rem 0.5rem; margin: 0 0.25rem;" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="excluirMorador(${morador.id})" class="danger-btn" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function filtrarCorrespondencias() {
            const filtroMorador = document.getElementById('filtroMorador').value.toLowerCase();
            const filtroBloco = document.getElementById('filtroBloco').value;
            const filtroStatus = document.getElementById('filtroStatus').value;
            
            let correspondenciasFiltradas = correspondencias.filter(corr => {
                const matchMorador = !filtroMorador || corr.morador.toLowerCase().includes(filtroMorador);
                const matchBloco = !filtroBloco || corr.bloco === filtroBloco;
                const matchStatus = !filtroStatus || corr.status === filtroStatus;
                
                return matchMorador && matchBloco && matchStatus;
            });
            
            const tbody = document.getElementById('tabelaCorrespondencias');
            
            if (correspondenciasFiltradas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem; color: #666;">
                            Nenhuma correspondÃªncia encontrada com os filtros selecionados
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = correspondenciasFiltradas.map(corr => {
                const morador = moradores.find(m => m.id === corr.moradorId);
                const diasAtrasada = calcularDiasAtrasada(corr.data);
                const isAtrasada = corr.status === 'Pendente' && diasAtrasada > 3;
                
                return `
                    <tr ${isAtrasada ? 'style="background-color: #fff5f5;"' : ''}>
                        <td>
                            ${formatarData(corr.data)}<br>
                            <small style="color: #666;">${corr.hora}</small>
                        </td>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">
                                    ${corr.morador.charAt(0).toUpperCase()}
                                </div>
                                <strong>${corr.morador}</strong>
                            </div>
                        </td>
                        <td>Bloco ${corr.bloco}<br>Apt ${corr.apartamento}</td>
                        <td style="max-width: 200px; word-wrap: break-word;">${corr.descricao}</td>
                        <td>
                            <span class="status-badge ${corr.status === 'Entregue' ? 'status-entregue' : 'status-pendente'}">
                                ${corr.status}
                            </span>
                            ${isAtrasada ? '<br><small style="color: #d32f2f;">Atrasada</small>' : ''}
                        </td>
                        <td>
                            ${corr.status === 'Pendente' ? `
                                <button onclick="marcarComoEntregue(${corr.id})" class="btn btn-success" style="padding: 0.25rem 0.5rem; margin: 0.1rem;" title="Marcar como entregue">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button onclick="reenviarNotificacao(${corr.id})" class="notify-btn" style="padding: 0.25rem 0.5rem; margin: 0.1rem;" title="Reenviar notificaÃ§Ã£o">
                                    <i class="fab fa-whatsapp"></i>
                                </button>
                            ` : ''}
                            <button onclick="excluirCorrespondencia(${corr.id})" class="danger-btn" style="margin: 0.1rem;" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function limparFiltros() {
            document.getElementById('filtroMorador').value = '';
            document.getElementById('filtroBloco').value = '';
            document.getElementById('filtroStatus').value = '';
            filtrarCorrespondencias();
        }

        // AÃ§Ãµes rÃ¡pidas
        function notificarAtrasadas() {
            const atrasadas = correspondencias.filter(c => 
                c.status === 'Pendente' && calcularDiasAtrasada(c.data) > 3
            );
            
            if (atrasadas.length === 0) {
                mostrarToast('NÃ£o hÃ¡ correspondÃªncias atrasadas no momento.', 'error');
                return;
            }
            
            let count = 0;
            atrasadas.forEach(corr => {
                const morador = moradores.find(m => m.id === corr.moradorId);
                if (morador) {
                    const diasAtrasada = calcularDiasAtrasada(corr.data);
                    const mensagem = `ð¨ URGENTE: Sua correspondÃªncia estÃ¡ hÃ¡ ${diasAtrasada} dias na portaria! DescriÃ§Ã£o: ${corr.descricao}. Por favor, retire o quanto antes.`;
                    const urlWhatsApp = `https://wa.me/55${morador.telefone.replace(/\D/g, '')}?text=${encodeURIComponent(mensagem)}`;
                    window.open(urlWhatsApp, '_blank');
                    count++;
                }
            });
            
            mostrarToast(`${count} notificaÃ§Ã£o(Ãµes) de correspondÃªncias atrasadas enviadas!`);
        }

        function exportarDados() {
            const dadosExport = {
                moradores,
                correspondencias,
                dataExportacao: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(dadosExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `correspondencias_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            mostrarToast('Dados exportados com sucesso!');
        }

        function exportarCorrespondencias() {
            if (correspondencias.length === 0) {
                mostrarToast('NÃ£o hÃ¡ correspondÃªncias para exportar!', 'error');
                return;
            }
            
            let csv = 'Data,Hora,Morador,Bloco,Apartamento,DescriÃ§Ã£o,Status,Data Entrega\n';
            
            correspondencias.forEach(corr => {
                const dataEntrega = corr.dataEntrega ? new Date(corr.dataEntrega).toLocaleDateString('pt-BR') : '';
                csv += `"${formatarData(corr.data)}","${corr.hora}","${corr.morador}","${corr.bloco}","${corr.apartamento}","${corr.descricao}","${corr.status}","${dataEntrega}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `correspondencias_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            mostrarToast('CorrespondÃªncias exportadas para CSV!');
        }

        // UtilitÃ¡rios
        function formatarData(dataString) {
            const data = new Date(dataString + 'T00:00:00');
            return data.toLocaleDateString('pt-BR');
        }

        function calcularDiasAtrasada(dataString) {
            const dataCorrespondencia = new Date(dataString + 'T00:00:00');
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            const diffTime = hoje - dataCorrespondencia;
            return Math.floor(diffTime / (1000 * 60 * 60 * 24));
        }

        function limparFormulario(formId) {
            document.getElementById(formId).reset();
            if (formId === 'formCorrespondencia') {
                document.getElementById('dataRecebimento').value = new Date().toISOString().split('T')[0];
                document.getElementById('horaRecebimento').value = new Date().toTimeString().slice(0, 5);
                document.getElementById('contadorCaracteres').textContent = '0/500 caracteres';
            }
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            editandoMoradorId = null;
        }

        function mostrarToast(mensagem, tipo = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${tipo === 'error' ? 'error' : ''}`;
            toast.innerHTML = `
                <i class="fas ${tipo === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'}"></i>
                ${mensagem}
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                    editandoMoradorId = null;
                }
            });
        }

        // Dados de demonstraÃ§Ã£o (apenas se nÃ£o houver dados salvos)
        function adicionarDadosDemonstracao() {
            // SÃ³ adicionar se realmente nÃ£o hÃ¡ dados
            if (moradores.length > 0 || correspondencias.length > 0) {
                return;
            }

            // Moradores de exemplo
            const moradoresDemo = [
                { id: 1, nome: 'JoÃ£o Silva', telefone: '(11) 99999-1111', bloco: 'A', apartamento: '101', dataCadastro: new Date().toISOString() },
                { id: 2, nome: 'Maria Santos', telefone: '(11) 99999-2222', bloco: 'A', apartamento: '102', dataCadastro: new Date().toISOString() },
                { id: 3, nome: 'Pedro Oliveira', telefone: '(11) 99999-3333', bloco: 'B', apartamento: '201', dataCadastro: new Date().toISOString() },
                { id: 4, nome: 'Ana Costa', telefone: '(11) 99999-4444', bloco: 'B', apartamento: '202', dataCadastro: new Date().toISOString() },
                { id: 5, nome: 'Carlos Pereira', telefone: '(11) 99999-5555', bloco: 'C', apartamento: '301', dataCadastro: new Date().toISOString() }
            ];

            // CorrespondÃªncias de exemplo
            const hoje = new Date().toISOString().split('T')[0];
            const ontem = new Date(Date.now() - 86400000).toISOString().split('T')[0];
            const anteontem = new Date(Date.now() - 172800000).toISOString().split('T')[0];
            const semanaPassada = new Date(Date.now() - 604800000).toISOString().split('T')[0];

            const correspondenciasDemo = [
                {
                    id: 1,
                    data: hoje,
                    hora: '10:30',
                    moradorId: 1,
                    morador: 'JoÃ£o Silva',
                    bloco: 'A',
                    apartamento: '101',
                    descricao: 'Encomenda dos Correios - Caixa mÃ©dia',
                    status: 'Pendente',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 2,
                    data: ontem,
                    hora: '14:15',
                    moradorId: 2,
                    morador: 'Maria Santos',
                    bloco: 'A',
                    apartamento: '102',
                    descricao: 'CorrespondÃªncia bancÃ¡ria - Envelope',
                    status: 'Entregue',
                    dataRegistro: new Date().toISOString(),
                    dataEntrega: new Date().toISOString()
                },
                {
                    id: 3,
                    data: semanaPassada,
                    hora: '09:00',
                    moradorId: 3,
                    morador: 'Pedro Oliveira',
                    bloco: 'B',
                    apartamento: '201',
                    descricao: 'Encomenda Mercado Livre - Caixa grande',
                    status: 'Pendente',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 4,
                    data: anteontem,
                    hora: '16:45',
                    moradorId: 4,
                    morador: 'Ana Costa',
                    bloco: 'B',
                    apartamento: '202',
                    descricao: 'Revista em casa - Envelope',
                    status: 'Entregue',
                    dataRegistro: new Date().toISOString(),
                    dataEntrega: new Date().toISOString()
                }
            ];

            // Adicionar dados
            moradores.push(...moradoresDemo);
            correspondencias.push(...correspondenciasDemo);

            // Salvar dados localmente
            salvarDados();

            // Atualizar interface
            atualizarDashboard();
            atualizarSelectsBlocos();
            atualizarTabelaMoradores();
            atualizarTabelaCorrespondencias();
            
            mostrarToast('Dados de demonstraÃ§Ã£o carregados! Agora vocÃª pode testar o sistema.', 'success');
        }
    </script>
</body>
</html>
